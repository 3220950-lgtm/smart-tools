<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Tools Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #D0BCFF;
            --surface: rgba(30, 30, 30, 0.65);
            --background: #121212;
            --text: #E6E1E5;
            --radius: 20px;
            --success: #81c784;
            --danger: #e57373;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            font-family: 'Heebo', sans-serif;
            margin: 0; padding: 15px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            background-attachment: fixed; background-size: cover;
            color: var(--text);
            transition: background 0.5s;
        }

        /* Backgrounds */
        .bg-1 { background: linear-gradient(to right, #24243e, #302b63, #0f0c29); }
        .bg-2 { background: linear-gradient(to bottom, #323232 0%, #3F5EFB 40%, #FC466B 100%); }
        .bg-3 { background: radial-gradient(circle at center, #1a2980 0%, #26d0ce 100%); }

        header {
            width: 100%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; z-index: 2;
        }
        h1 { font-size: 1.6rem; font-weight: 700; margin: 0; }
        .theme-btn {
            background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px;
            border-radius: 50%; cursor: pointer; font-size: 1.2rem; backdrop-filter: blur(5px);
        }

        /* Grid */
        .grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            width: 100%; max-width: 500px; padding-bottom: 80px;
        }

        .card {
            background: var(--surface); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius);
            padding: 10px; height: 100px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; cursor: pointer; transition: transform 0.15s;
        }
        .card:active { transform: scale(0.95); background: rgba(60,60,60,0.8); }
        .icon { font-size: 1.8rem; margin-bottom: 5px; }
        .card h3 { font-size: 0.8rem; margin: 0; font-weight: 400; }

        /* Overlay */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 100;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .overlay.active { transform: translateY(0); }
        
        .navbar {
            padding: 15px; display: flex; align-items: center;
            background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .back-btn { background: none; border: none; color: white; font-size: 1.5rem; padding: 5px 15px; cursor: pointer; }
        .nav-title { font-size: 1.2rem; font-weight: bold; margin-right: 10px; }
        
        .content {
            flex: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Form Elements */
        input, select {
            width: 100%; background: #333; border: 1px solid #444; color: white;
            padding: 12px; border-radius: 12px; font-size: 1rem; margin-bottom: 10px;
            text-align: center;
        }
        .action-btn {
            background: var(--primary); color: #222; width: 100%;
            border: none; padding: 12px; border-radius: 50px;
            font-size: 1rem; font-weight: bold; margin-top: 10px; cursor: pointer;
        }
        .btn-red { background: var(--danger); color: white; }
        .btn-green { background: var(--success); color: #222; }

        /* --- Specific Tools --- */
        
        /* Maaser Tracker */
        .maaser-summary {
            width: 100%; background: rgba(255,255,255,0.1); border-radius: 15px;
            padding: 15px; margin-bottom: 20px; text-align: center;
        }
        .balance-text { font-size: 2rem; font-weight: bold; direction: ltr; }
        .history-list { width: 100%; margin-top: 20px; }
        .history-item {
            display: flex; justify-content: space-between; padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem;
        }
        .item-income { color: var(--success); }
        .item-give { color: var(--danger); }

        /* Interest Calc */
        .result-box {
            width: 100%; background: #222; padding: 20px; border-radius: 15px;
            margin-top: 20px; text-align: center; display: none;
        }

        /* Other Tools CSS (Compass, Level, etc) */
        video { width: 100%; height: 100%; object-fit: cover; }
        .mirror-mode { transform: scaleX(-1); }
        .level-box {
            width: 250px; height: 250px; border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%; position: relative; background: rgba(255,255,255,0.05);
        }
        .bubble {
            width: 40px; height: 40px; background: #00ff88; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

    </style>
</head>
<body class="bg-1">

    <header>
        <h1>Smart Tools <span style="font-size:0.8rem; opacity:0.7">Pro</span></h1>
        <button class="theme-btn" onclick="toggleTheme()">ğŸ¨</button>
    </header>

    <div class="grid">
        <div class="card" onclick="openTool('maaser')"><div class="icon">ğŸ’¸</div><h3>××¢×©×¨×•×ª</h3></div>
        <div class="card" onclick="openTool('interest')"><div class="icon">ğŸ“ˆ</div><h3>×¨×™×‘×™×ª</h3></div>
        <div class="card" onclick="openTool('converter')"><div class="icon">ğŸ“</div><h3>×××™×¨</h3></div>

        <div class="card" onclick="openTool('mirror')"><div class="icon">ğŸª</div><h3>××¨××”</h3></div>
        <div class="card" onclick="openTool('light')"><div class="icon">ğŸ’¡</div><h3>×¤× ×¡</h3></div>
        <div class="card" onclick="openTool('stopwatch')"><div class="icon">â±ï¸</div><h3>×¡×˜×•×¤×¨</h3></div>

        <div class="card" onclick="openTool('compass')"><div class="icon">ğŸ§­</div><h3>××¦×¤×Ÿ</h3></div>
        <div class="card" onclick="openTool('level')"><div class="icon">ğŸ’§</div><h3>×¤×œ×¡</h3></div>
        <div class="card" onclick="openTool('battery')"><div class="icon">ğŸ”‹</div><h3>×¡×•×œ×œ×”</h3></div>
        
        <div class="card" onclick="openTool('notes')"><div class="icon">ğŸ“</div><h3>×¤×ª×§×™×</h3></div>
        <div class="card" onclick="openTool('noise')"><div class="icon">ğŸ”Š</div><h3>×¨×¢×©</h3></div>
        <div class="card" onclick="openTool('magnifier')"><div class="icon">ğŸ”</div><h3>×–×›×•×›×™×ª</h3></div>
    </div>

    <div id="maaser" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('maaser')">âœ</button><span class="nav-title">××¢×§×‘ ××¢×©×¨ ×›×¡×¤×™×</span></div>
        <div class="content">
            <div class="maaser-summary">
                <span>×™×ª×¨×” ×œ×ª×©×œ×•× (×—×•×‘ ×œ××¢×©×¨):</span>
                <div id="maaserBalance" class="balance-text">â‚ª0</div>
            </div>

            <div style="display: flex; gap:10px; width:100%;">
                <div style="flex:1">
                    <input type="number" id="incomeInput" placeholder="×¡×›×•× ×”×›× ×¡×”">
                    <button class="action-btn btn-green" onclick="addTransaction('income')">+ ×”×•×¡×£ ×”×›× ×¡×”</button>
                </div>
                <div style="flex:1">
                    <input type="number" id="giveInput" placeholder="×¡×›×•× ×©× ×ª×ª×™">
                    <button class="action-btn btn-red" onclick="addTransaction('give')">- ×”×•×¡×£ × ×ª×™× ×”</button>
                </div>
            </div>
            <input type="text" id="transNote" placeholder="×”×¢×¨×” (××•×¤×¦×™×•× ×œ×™)" style="margin-top:10px;">

            <div style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
                <h4>×”×™×¡×˜×•×¨×™×”</h4>
                <button onclick="clearMaaser()" style="background:none; border:none; color:#aaa;">× ×§×” ×”×›×œ</button>
            </div>
            <div id="maaserHistory" class="history-list"></div>
        </div>
    </div>

    <div id="interest" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('interest')">âœ</button><span class="nav-title">×¨×™×‘×™×ª ×“×¨×™×‘×™×ª</span></div>
        <div class="content">
            <label>×¡×›×•× ×”×ª×—×œ×ª×™</label>
            <input type="number" id="p_init" value="10000">
            
            <label>×”×¤×§×“×” ×—×•×“×©×™×ª</label>
            <input type="number" id="p_monthly" value="500">
            
            <label>×¨×™×‘×™×ª ×©× ×ª×™×ª (%)</label>
            <input type="number" id="p_rate" value="7">
            
            <label>××¡×¤×¨ ×©× ×™×</label>
            <input type="number" id="p_years" value="10">

            <button class="action-btn" onclick="calcInterest()">×—×©×‘</button>

            <div id="roiResult" class="result-box">
                <p>×¡×”"×› ×‘×¡×•×£ ×”×ª×§×•×¤×”:</p>
                <h2 id="roiTotal" style="color:var(--success)">â‚ª0</h2>
                <p>××ª×•×š ×–×” ×¨×•×•×— ××¨×™×‘×™×ª: <span id="roiProfit">0</span></p>
                <p>×¡×›×•× ×©×”×•×¤×§×“: <span id="roiInvested">0</span></p>
            </div>
        </div>
    </div>

    <div id="notes" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('notes')">âœ</button><span class="nav-title">×¤×ª×§×™×</span></div>
        <div class="content">
            <textarea id="noteArea" style="width:100%; height:100%; background: transparent; border:none; color:white; font-size:1.2rem; resize:none; outline:none;" placeholder="×›×ª×•×‘ ×›××Ÿ..."></textarea>
        </div>
    </div>

    <div id="converter" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('converter')">âœ</button><span class="nav-title">×××™×¨ ×™×—×™×“×•×ª</span></div>
        <div class="content">
            <label>×¡× ×˜×™××˜×¨ / ××™× ×¥'</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="cmIn" placeholder="CM" oninput="conv('cm')">
                <input type="number" id="inchIn" placeholder="Inch" oninput="conv('inch')">
            </div>
            <label style="margin-top:20px">×§×™×œ×•×’×¨× / ×¤××•× ×“</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="kgIn" placeholder="KG" oninput="conv('kg')">
                <input type="number" id="lbIn" placeholder="LBS" oninput="conv('lbs')">
            </div>
        </div>
    </div>

    <div id="mirror" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('mirror')">âœ</button><span>××¨××”</span></div><div class="content" style="padding:0; background:black;"><video id="mirrorVideo" autoplay playsinline class="mirror-mode"></video></div></div>
    <div id="battery" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('battery')">âœ</button><span>×¡×•×œ×œ×”</span></div><div class="content"><h1 id="batVal">--%</h1></div></div>
    <div id="stopwatch" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('stopwatch')">âœ</button><span>×¡×˜×•×¤×¨</span></div><div class="content"><h1 id="swDisplay" style="font-size:4rem">00:00</h1><button class="action-btn" onclick="startSW()">×”×ª×—×œ/×¢×¦×•×¨</button><button class="action-btn" onclick="resetSW()" style="background:#555">××™×¤×•×¡</button></div></div>
    <div id="light" class="overlay" style="background:white"><button onclick="closeTool('light')" style="position:absolute; bottom:50px; left:50%; transform:translateX(-50%); padding:15px; border-radius:30px; border:none; background:#333; color:white;">×›×‘×” ×¤× ×¡</button></div>
    <div id="compass" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('compass')">âœ</button><span>××¦×¤×Ÿ</span></div><div class="content"><button class="action-btn" id="sBtn1" onclick="reqSens()">×”×¤×¢×œ ×—×™×™×©× ×™×</button><h1 id="compVal">0Â°</h1></div></div>
    <div id="level" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('level')">âœ</button><span>×¤×œ×¡</span></div><div class="content"><button class="action-btn" id="sBtn2" onclick="reqSens()">×”×¤×¢×œ ×—×™×™×©× ×™×</button><div class="level-box"><div id="lbubble" class="bubble"></div></div></div></div>
    <div id="noise" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('noise')">âœ</button><span>×¨×¢×©</span></div><div class="content"><button class="action-btn" onclick="initMic()">×”×¤×¢×œ ××™×§×¨×•×¤×•×Ÿ</button><div style="height:50px; width:100%; background:#333; margin-top:20px;"><div id="noiseBar" style="height:100%; width:0%; background:lime;"></div></div></div></div>
    <div id="magnifier" class="overlay"><div class="navbar"><button class="back-btn" onclick="closeTool('magnifier')">âœ</button><span>×–×›×•×›×™×ª ××’×“×œ×ª</span></div><div class="content" style="padding:0; background:black;"><video id="magVideo" autoplay playsinline></video></div></div>

    <script>
        // --- CORE ---
        let bgIdx = 1;
        function toggleTheme() { bgIdx = bgIdx >= 3 ? 1 : bgIdx + 1; document.body.className = 'bg-' + bgIdx; }
        function openTool(id) {
            document.getElementById(id).classList.add('active');
            if(id==='mirror') startCam('mirrorVideo','user');
            if(id==='magnifier') startCam('magVideo','environment');
            if(id==='battery' && navigator.getBattery) navigator.getBattery().then(b=>document.getElementById('batVal').innerText=Math.round(b.level*100)+'%');
            if(id==='maaser') renderMaaser();
            if(id==='notes') document.getElementById('noteArea').value = localStorage.getItem('notes') || '';
        }
        function closeTool(id) {
            document.getElementById(id).classList.remove('active');
            stopCam();
            if(id==='notes') localStorage.setItem('notes', document.getElementById('noteArea').value);
        }

        // --- MAASER LOGIC ---
        function getMaaserData() { return JSON.parse(localStorage.getItem('maaserData')) || []; }
        function addTransaction(type) {
            let amount = parseFloat(document.getElementById(type === 'income' ? 'incomeInput' : 'giveInput').value);
            let note = document.getElementById('transNote').value;
            if(!amount) return;

            let data = getMaaserData();
            // ×× ×–×• ×”×›× ×¡×”, ×”××¢×©×¨ ×”×•× 10% ××”×¡×›×•×. ×× ×–×• × ×ª×™× ×”, ×–×” ×”×¡×›×•× ×”××œ×.
            let maaserValue = (type === 'income') ? (amount * 0.1) : amount; 
            
            data.unshift({
                type: type, // 'income' or 'give'
                originalAmount: amount, // ×›××” ×”×›× ×™×¡ ×‘×¤×•×¢×œ
                value: maaserValue, // ×›××” ×–×” ×©×•×•×” ×‘×—×™×©×•×‘ ×”××¢×©×¨
                note: note,
                date: new Date().toLocaleDateString('he-IL')
            });
            localStorage.setItem('maaserData', JSON.stringify(data));
            
            // ××™×¤×•×¡ ×©×“×•×ª
            document.getElementById('incomeInput').value = '';
            document.getElementById('giveInput').value = '';
            document.getElementById('transNote').value = '';
            renderMaaser();
        }

        function renderMaaser() {
            let data = getMaaserData();
            let totalObligation = 0; // ×›××” ×¦×¨×™×š ×œ×ª×ª
            let totalGiven = 0;      // ×›××” × ×ª×Ÿ ×‘×¤×•×¢×œ
            
            let html = '';
            data.forEach(item => {
                if(item.type === 'income') totalObligation += item.value;
                else totalGiven += item.value;

                let symbol = item.type === 'income' ? '+' : '-';
                let colorClass = item.type === 'income' ? 'item-income' : 'item-give';
                let text = item.type === 'income' ? `×”×›× ×¡×” ×©×œ ${item.originalAmount} (××¢×©×¨: ${item.value})` : `× ×ª×™× ×”: ${item.originalAmount}`;
                
                html += `<div class="history-item ${colorClass}">
                            <span>${item.date} | ${item.note || ''}</span>
                            <strong>${text}</strong>
                        </div>`;
            });

            document.getElementById('maaserHistory').innerHTML = html;
            // ×—×™×©×•×‘ ×™×ª×¨×”: (×—×•×‘ ××¦×˜×‘×¨) ×¤×—×•×ª (××” ×©× ×ª×ª×™)
            let balance = totalObligation - totalGiven;
            document.getElementById('maaserBalance').innerText = 'â‚ª' + balance.toFixed(1);
            // ×× ×”××¡×¤×¨ ×—×™×•×‘×™ - × ×©××¨ ×—×•×‘. ×× ×©×œ×™×œ×™ - ×™×© ×™×ª×¨×ª ×–×›×•×ª.
            document.getElementById('maaserBalance').style.color = balance > 0 ? '#e57373' : '#81c784';
        }
        function clearMaaser() { if(confirm('×œ××—×•×§ ×”×›×œ?')) { localStorage.removeItem('maaserData'); renderMaaser(); } }

        // --- INTEREST CALC ---
        function calcInterest() {
            let P = parseFloat(document.getElementById('p_init').value);
            let PMT = parseFloat(document.getElementById('p_monthly').value);
            let r = parseFloat(document.getElementById('p_rate').value) / 100;
            let t = parseFloat(document.getElementById('p_years').value);
            let n = 12; // ×—×•×“×©×™

            // × ×•×¡×—×ª ×¢×¨×š ×¢×ª×™×“×™ ×¢× ×”×¤×§×“×•×ª ×—×•×“×©×™×•×ª
            // FV = P * (1+r/n)^(n*t) + PMT * [ (1+r/n)^(n*t) - 1 ] / (r/n)
            let ratePerPeriod = r/n;
            let totalPeriods = n*t;
            
            let futureValueInit = P * Math.pow(1 + ratePerPeriod, totalPeriods);
            let futureValuePMT = PMT * (Math.pow(1 + ratePerPeriod, totalPeriods) - 1) / ratePerPeriod;
            
            let total = futureValueInit + futureValuePMT;
            let invested = P + (PMT * 12 * t);
            let profit = total - invested;

            document.getElementById('roiTotal').innerText = 'â‚ª' + Math.round(total).toLocaleString();
            document.getElementById('roiProfit').innerText = 'â‚ª' + Math.round(profit).toLocaleString();
            document.getElementById('roiInvested').innerText = 'â‚ª' + Math.round(invested).toLocaleString();
            document.getElementById('roiResult').style.display = 'block';
        }

        // --- CONVERTER ---
        function conv(t) {
            if(t=='cm') document.getElementById('inchIn').value = (document.getElementById('cmIn').value * 0.3937).toFixed(2);
            if(t=='inch') document.getElementById('cmIn').value = (document.getElementById('inchIn').value * 2.54).toFixed(2);
            if(t=='kg') document.getElementById('lbIn').value = (document.getElementById('kgIn').value * 2.204).toFixed(2);
            if(t=='lbs') document.getElementById('kgIn').value = (document.getElementById('lbIn').value / 2.204).toFixed(2);
        }

        // --- COMMON UTILS ---
        let stream;
        async function startCam(id, mode) { try{ stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:mode}}); document.getElementById(id).srcObject=stream; }catch(e){} }
        function stopCam() { if(stream) stream.getTracks().forEach(t=>t.stop()); }
        
        // --- SENSORS SHORTCUTS ---
        function reqSens() { 
            if(typeof DeviceOrientationEvent.requestPermission==='function') DeviceOrientationEvent.requestPermission().then(r=>{if(r==='granted') window.addEventListener('deviceorientation', hMot)});
            else window.addEventListener('deviceorientation', hMot);
            document.getElementById('sBtn1').style.display='none'; document.getElementById('sBtn2').style.display='none';
        }
        function hMot(e) {
            document.getElementById('compVal').innerText = Math.round(e.webkitCompassHeading || Math.abs(e.alpha-360)) + 'Â°';
            let x=e.gamma, y=e.beta;
            document.getElementById('lbubble').style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
        }

        // --- STOPWATCH & MIC ---
        let swI, swS;
        function startSW() { if(swI) { clearInterval(swI); swI=null; } else { let st=Date.now()-(swS||0); swI=setInterval(()=>{ swS=Date.now()-st; document.getElementById('swDisplay').innerText=(swS/1000).toFixed(2);},50); } }
        function resetSW() { clearInterval(swI); swI=null; swS=0; document.getElementById('swDisplay').innerText="00:00"; }
        
        async function initMic() {
            try { let s=await navigator.mediaDevices.getUserMedia({audio:true}); let ac=new AudioContext(); let src=ac.createMediaStreamSource(s); let an=ac.createAnalyser(); src.connect(an); 
            let buf=new Uint8Array(an.frequencyBinCount);
            setInterval(()=>{ an.getByteFrequencyData(buf); let avg=buf.reduce((a,b)=>a+b)/buf.length; document.getElementById('noiseBar').style.height=(avg*1.5)+'%'; },100);
            } catch(e){}
        }

    </script>
</body>
</html>
